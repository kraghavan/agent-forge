flowchart TB
    subgraph External["External APIs"]
        API[("Open-Meteo API")]
        CLAUDE[("Claude API")]
    end

    subgraph Config["Configuration"]
        CITIES[("cities.json")]
    end

    subgraph Kafka["Apache Kafka :9092"]
        AMBIENT[/"weather-ambient"/]
        EXTREME[/"weather-extreme"/]
        DLQ[/"weather-dlq"/]
    end

    subgraph Agents["Processing Agents"]
        PUB["Publisher :8180"]
        CON["Consumer :8181"]
    end

    subgraph Storage["Data Storage"]
        INFLUX[("InfluxDB :8086")]
        LOKI[("Loki :3100")]
    end

    subgraph Monitoring["Monitoring Stack"]
        PROM["Prometheus :9090"]
        KAFEX["Kafka-Exporter :9308"]
        ALERT["Alertmanager :9094"]
        PROMTAIL["Promtail"]
    end

    subgraph Visualization["Visualization"]
        GRAF["Grafana :3000"]
        KAFUI["Kafka-UI :8080"]
    end

    CITIES --> PUB
    API --> PUB
    CLAUDE --> PUB
    
    PUB --> AMBIENT
    PUB --> EXTREME
    AMBIENT --> CON
    EXTREME --> CON
    CON --> DLQ
    CON --> INFLUX
    
    PUB -.-> PROM
    CON -.-> PROM
    KAFEX -.-> PROM
    PROM --> ALERT
    PROM --> GRAF
    INFLUX --> GRAF
    LOKI --> GRAF
    PROMTAIL --> LOKI
    Kafka -.-> KAFUI
    Kafka -.-> KAFEX

    style PUB fill:#4CAF50,color:#fff
    style CON fill:#2196F3,color:#fff
    style AMBIENT fill:#8BC34A,color:#000
    style EXTREME fill:#f44336,color:#fff
    style DLQ fill:#9E9E9E,color:#fff
    style CLAUDE fill:#7C3AED,color:#fff
    style API fill:#FF9800,color:#000
    style INFLUX fill:#9C27B0,color:#fff
    style GRAF fill:#FF5722,color:#fff
    style PROM fill:#E91E63,color:#fff
    style ALERT fill:#F44336,color:#fff
    style LOKI fill:#00BCD4,color:#000
    style KAFEX fill:#795548,color:#fff
    style CITIES fill:#607D8B,color:#fff