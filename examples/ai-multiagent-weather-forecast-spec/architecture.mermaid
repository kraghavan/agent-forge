flowchart TB
    subgraph External
        API[("ğŸŒ¤ï¸ Open-Meteo API")]
    end

    subgraph Kafka["Apache Kafka (KRaft)"]
        direction LR
        AMBIENT[/"weather-ambient"/]
        EXTREME[/"weather-extreme"/]
    end

    subgraph Agents
        PUB["ğŸ“¤ Publisher Agent<br/>:8180"]
        CON["ğŸ“¥ Consumer Agent<br/>:8181"]
    end

    subgraph Storage
        INFLUX[("ğŸ“Š InfluxDB<br/>:8086")]
    end

    subgraph Observability
        PROM["ğŸ“ˆ Prometheus<br/>:9090"]
        GRAF["ğŸ“‰ Grafana<br/>:3000"]
        KAFUI["ğŸ” Kafka-UI<br/>:8080"]
    end

    API -->|"fetch weather<br/>every 60s"| PUB
    
    PUB -->|"temp â‰¥ -10Â°C<br/>wind â‰¤ 40km/h"| AMBIENT
    PUB -->|"temp < -10Â°C<br/>OR wind > 40km/h"| EXTREME
    
    AMBIENT --> CON
    EXTREME --> CON
    
    CON -->|"raw + avg"| INFLUX
    
    PUB -.->|"/metrics"| PROM
    CON -.->|"/metrics"| PROM
    
    PROM --> GRAF
    INFLUX --> GRAF
    
    Kafka -.-> KAFUI

    style PUB fill:#4CAF50,color:#fff
    style CON fill:#2196F3,color:#fff
    style AMBIENT fill:#8BC34A,color:#000
    style EXTREME fill:#f44336,color:#fff
    style INFLUX fill:#9C27B0,color:#fff
    style GRAF fill:#FF9800,color:#000
    style PROM fill:#E91E63,color:#fff